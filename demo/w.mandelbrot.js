var i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;function y(a,e){var c,d;c=m*(p*a/t-1.75)+k;d=m/r*(q*e/u-1)+l;var b=(c-0.25)*(c-0.25)+d*d;if(c<=Math.sqrt(b)-2*b+0.25)return v;var f=b=0,g,h;for(g=0;4>b*b+f*f&&g<v;g++)h=b*b-f*f+c,f=2*b*f+d,b=h;return g}function z(a){for(var e=0,c=a.length,d=0;d<c;d++)e+=a[d];return e/c}function A(a,e){for(var c=a.length,d=0,b=0;b<c;b++)var f=a[b]-e,d=d+f*f;return Math.pow(d/c,0.5)}
handleInitRequest=function(a){a=a.data.settings;p=a.dx;q=a.dy;r=a.forcedHeight;t=a.width;u=a.height;v=a.maxIteration;x=a.minStdDev};
handleRenderRequest=function(a,e){var c=e.data.state;k=c.x;l=c.y;m=c.z;n=c.blockOffset;s=c.blockSize;o=c.index;j=e.data.buffer;w=new Uint32Array(j);for(c=0;c<s/4;c++){var d=n/4+c,b=d%t,f=Math.floor(d/t),d=f*t+b,b=y(b,f),g=f=void 0,h=void 0,b=6*b/v;1>b?(f=255,g=255*b,h=0):2>b?(f=255*(2-b),g=255,h=0):3>b?(f=0,g=255,h=255*(b-2)):4>b?(f=0,g=255*(4-b),h=255):5>b?(f=255*(b-4),g=0,h=255):(f=255,g=0,h=255*(6-b));w[d-n/4]=-16777216|h<<16|g<<8|f}a.imagedata=j;a.blockOffset=n;a.index=o};
handleRandomRequest=function(){var a,e,c,d=0;do{a=[];m=1/Math.pow(2,Math.floor(22*Math.random())+10);k=p*(Math.random()-0.5);l=q*(Math.random()-0.5);for(d=0;32>d;d++)e=Math.floor(d%4*t/4),c=Math.floor(Math.floor(d/4)*u/4),a.push(y(e,c));d++}while(A(a,z(a))<x&&100>d)};
self.onmessage=function(a){var e={};i=e.type=a.data.type;switch(i){case "init":handleInitRequest(a);break;case "render":handleRenderRequest(e,a);break;case "random":handleRandomRequest()}e.x=k;e.y=l;e.z=m;j&&j.byteLength?self.postMessage(e,[j]):self.postMessage(e)};
