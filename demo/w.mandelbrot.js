var h=void 0,i,j,k,l,o,p,q,r,s,t,u,v,w;
self.onmessage=function(g){var f=g.data.state,e=g.data.settings;i=f.x;j=f.y;k=f.z;l=f.blockOffset;o=e.dx;p=e.dy;q=e.forcedHeight;s=r=e.totalPixels;t=e.width;u=e.height;v=e.maxIteration;g=g.data.buffer;w=new Uint32Array(g,0,s);f=r+l>s?s-l:r;for(e=0;e<f;e++){var m=l+e,b=m%t,c=Math.floor(m/t),m=c*t+b,a;var d=a=h;a=k*(o*b/t-1.75)+i;d=k/q*(p*c/u-1)+j;b=(a-0.25)*(a-0.25)+d*d;if(a<=Math.sqrt(b)-2*b+0.25)a=v;else{for(var c=b=0,n=h,x=h,n=0;4>b*b+c*c&&n<v;n++)x=b*b-c*c+a,c=2*b*c+d,b=x;a=n}c=b=d=h;a=6*a/v;1>
a?(d=255,b=255*a,c=0):2>a?(d=255*(2-a),b=255,c=0):3>a?(d=0,b=255,c=255*(a-2)):4>a?(d=0,b=255*(4-a),c=255):5>a?(d=255*(a-4),b=0,c=255):(d=255,b=0,c=255*(6-a));w[m]=-16777216|c<<16|b<<8|d}f={};f.imagedata=g;f.blockOffset=l;self.webkitPostMessage(f,[g])};
