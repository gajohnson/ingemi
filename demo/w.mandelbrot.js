var j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y;function z(a,d){var b=n*(q*a/u-1.75)+l,e=n/s*(r*d/v-1)+m,f=(b-0.25)*(b-0.25)+e*e;if(b<=Math.sqrt(f)-2*f+0.25)return w;var c=f=0,g;for(g=0;4>f*f+c*c&&g<w;g++)var h=f*f-c*c+b,c=2*f*c+e,f=h;return g}function A(a){for(var d=0,b=a.length,e=0;e<b;e++)d+=a[e];return d/b}function B(a,d){for(var b=a.length,e=0,f=0;f<b;f++)var c=a[f]-d,e=e+c*c;return Math.pow(e/b,0.5)}handleInitRequest=function(a){q=a.dx;r=a.dy;s=a.forcedHeight;u=a.width;v=a.height;w=a.maxIteration;y=a.minStdDev};
handleRenderRequest=function(a,d){var b=d.state;l=b.x;m=b.y;n=b.z;o=b.blockOffset;t=b.blockSize;p=b.index;k=d.buffer;x=new Uint32Array(k);for(var b=o/4,e=b+t/4,f=b;b<e;b++){var c=z(b%u,Math.floor(b/u)),g=void 0,h=void 0,i=void 0,c=6*c/w;1>c?(g=255,h=255*c,i=0):2>c?(g=255*(2-c),h=255,i=0):3>c?(g=0,h=255,i=255*(c-2)):4>c?(g=0,h=255*(4-c),i=255):5>c?(g=255*(c-4),h=0,i=255):(g=255,h=0,i=255*(6-c));x[b-f]=-16777216|i<<16|h<<8|g}a.imagedata=k;a.blockOffset=o;a.index=p};
handleRandomRequest=function(){var a,d,b,e=0;do{a=[];n=1/Math.pow(2,Math.floor(22*Math.random())+10);l=q*(Math.random()-0.5);m=r*(Math.random()-0.5);for(e=0;32>e;e++)d=Math.floor(e%4*u/4),b=Math.floor(Math.floor(e/4)*v/4),a.push(z(d,b));e++}while(B(a,A(a))<y&&100>e)};
self.onmessage=function(a){var d={},a=a.data;j=d.type=a.type;switch(j){case "init":handleInitRequest(a.settings);break;case "render":handleRenderRequest(d,a);break;case "random":handleRandomRequest()}d.x=l;d.y=m;d.z=n;k&&k.byteLength?self.postMessage(d,[k]):self.postMessage(d)};
