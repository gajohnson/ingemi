var d;Ingemi=function(a,b){if(!a||"DIV"!=a.nodeName)throw Error("You must specify Ingemi's container");b=b||{};this.h=a;this.x=b.x||0;this.y=b.y||0;this.a=b.z||1;this.v=b.maxIteration||155;this.f=b.sample||1;this.g=b.workers||4;this.w=b.minStdDev||10;this.i=3.5;this.j=2;this.b=[];this.c=[];this.d=!1};d=Ingemi.prototype;d.t=function(){console.time("total");this.u();this.A();this.B()};d.u=function(){this.canvas=document.createElement("canvas");this.h.appendChild(this.canvas);this.m=this.canvas.getContext("2d")};
d.A=function(){this.clientWidth=this.h.clientWidth;this.clientHeight=this.h.clientHeight;this.width=Math.floor(this.clientWidth/this.f);this.height=Math.floor(this.clientHeight/this.f);this.canvas.style.width=this.clientWidth+"px";this.canvas.style.height=this.clientHeight+"px";this.s=Math.round(this.clientWidth*this.j/this.i)/this.clientHeight;this.o=this.width*this.height;this.n=this.m.createImageData(this.width,this.height);this.buffer=[];for(var a=0;a<this.g;a++)this.buffer[a]=new ArrayBuffer(this.k(a+
1)-this.k(a))};d.B=function(){for(var a=this,b=0;b<a.g;b++){a.b[b]=new Worker("w.mandelbrot.js");var e=a.l("init");a.b[b].postMessage(e);a.b[b].onmessage=function(b){a.x=b.data.x||a.x;a.y=b.data.y||a.y;a.a=b.data.z||a.a;var e=b.data.type;if("init"!=e)if("random"==e)a.e();else{e=b.data.index;a.buffer[e]=b.data.imagedata;var f=new Uint8ClampedArray(a.buffer[e]);a.n.data.set(f,b.data.blockOffset);a.c[e]=!0;a.q()}}}};d.q=function(){for(var a=0;a<this.c.length;a++)if(!this.c[a])return;this.r()};
d.e=function(){if(!this.d){this.d=!0;console.time("render");for(var a=0;a<this.g;a++){this.c[a]=!1;var b=this.l("render",a);this.b[a].postMessage(b,[this.buffer[a]])}}};
d.l=function(a,b){var e={};e.type=a;if("init"==a){var c=e.settings={};c.dx=this.i;c.dy=this.j;c.forcedHeight=this.s;c.totalPixels=this.o;c.width=this.width;c.height=this.height;c.maxIteration=this.v;c.minStdDev=this.w}else"render"==a&&(c=e.state={},c.x=this.x,c.y=this.y,c.z=this.a,c.blockOffset=this.k(b),c.blockSize=this.buffer[b].byteLength,c.index=b,e.buffer=this.buffer[b]);return e};d.k=function(a){return 4*Math.ceil(this.o*a/this.g)};
d.r=function(){this.canvas.width=this.width;this.canvas.height=this.height;this.m.putImageData(this.n,0,0);this.d=!1;console.timeEnd("render");console.timeEnd("total")};d.zoom=function(a){this.a*=a;this.e()};d.p=function(a,b){this.x+=(a/this.f/this.width-0.5)*this.i*this.a;this.y+=(b/this.f/this.height-0.5)*this.j*this.a;this.e()};d.reset=function(){this.y=this.x=0;this.a=1};d.random=function(){this.d||(console.time("render"),this.b[0].postMessage(this.l("random")))};window.Ingemi=Ingemi;
Ingemi.prototype.init=Ingemi.prototype.t;Ingemi.prototype.render=Ingemi.prototype.e;Ingemi.prototype.zoom=Ingemi.prototype.zoom;Ingemi.prototype.center=Ingemi.prototype.p;Ingemi.prototype.reset=Ingemi.prototype.reset;Ingemi.prototype.random=Ingemi.prototype.random;
