var f;Ingemi=function(b,a){if(!b||"DIV"!=b.nodeName)throw Error("You must specify the div where Ingemi will render");a=a||{};this.l=b;this.u=a.upscale||1;this.offsetLeft=a.offsetLeft||0;this.offsetTop=a.offsetTop||0;this.f=3.5;this.g=2;this.scale=1;this.G=a.minStdDev||10;this.k=a.maxIteration||255;this.e=a.blockSize||2E3;this.r="function"===typeof a.onrender?a.onrender:null;this.B=Math.round(b.clientWidth*this.g/this.f)/b.clientHeight;this.p=this.d=!1;this.I=2};f=Ingemi.prototype;
f.C=function(){this.F();this.t()};
f.F=function(){this.canvas=document.createElement("canvas");this.l.appendChild(this.canvas);this.w=this.canvas.getContext("2d");this.clientWidth=this.l.clientWidth;this.clientHeight=this.l.clientHeight;this.canvas.style.width=this.clientWidth+"px";this.canvas.style.height=this.clientHeight+"px";this.o=document.createElement("canvas");this.J=this.o.getContext("2d");this.status=document.getElementById("status");this.L=document.getElementById("x");this.M=document.getElementById("y");this.N=document.getElementById("z");
var b=this;setInterval(function(){b.status.innerText=Math.round(100*b.b/b.j)},1E3)};f.t=function(){this.width=Math.floor(this.clientWidth/this.a());this.height=Math.floor(this.clientHeight/this.a());this.o.width=this.width;this.o.height=this.height;this.c=this.J.createImageData(this.width,this.height);this.j=this.width*this.height};
f.m=function(){this.d||(this.d=!0,console.time("render"),this.status.innerText=0,this.L.innerText=this.offsetLeft,this.M.innerText=this.offsetTop,this.N.innerText=Math.log(1/this.scale)/Math.LN2,this.b=this.h=this.n=0,this.s())};f.i=function(){this.d&&this.cancel();this.p=!0;this.a(this.I);console.log("cancel");var b=this;setTimeout(function(){try{b.m()}catch(a){console.log("caught")}},0)};f.cancel=function(){throw Error("Cancel");};
f.s=function(){var b=this.e+this.b>this.j?this.j-this.b:this.e,a;for(a=0;a<b;a++){var c=this.b+a,e=c%this.width,d=Math.floor(c/this.width),c=4*(d*this.width+e);this.K(c,this.q(e,d));this.O()}};f.q=function(b,a){var c,e;c=this.scale*(this.f*b/this.width-1.75)+this.offsetLeft;e=this.scale/this.B*(this.g*a/this.height-1)+this.offsetTop;if(this.D(c,e))return this.k;var d=0,g=0,h,i;for(h=0;4>d*d+g*g&&h<this.k;h++)i=d*d-g*g+c,g=2*d*g+e,d=i;return h};
f.D=function(b,a){var c=(b-0.25)*(b-0.25)+a*a;return b<=Math.sqrt(c)-2*c+0.25};f.K=function(b,a){var c,e,d,a=6*a/this.k;1>a?(c=255,e=255*a,d=0):2>a?(c=255*(2-a),e=255,d=0):3>a?(c=0,e=255,d=255*(a-2)):4>a?(c=0,e=255*(4-a),d=255):5>a?(c=255*(a-4),e=0,d=255):(c=255,e=0,d=255*(6-a));this.c.data[b]=c;this.c.data[b+1]=e;this.c.data[b+2]=d;this.c.data[b+3]=255};f.O=function(){this.n+=1;this.h+=1;this.n==this.j?(this.z(),this.A()):this.h===this.e&&this.H()};f.H=function(){this.b+=this.e;this.h=0;this.s()};
f.z=function(){this.canvas.width=this.width;this.canvas.height=this.height;this.w.putImageData(this.c,0,0)};f.A=function(){this.status.innerText=100;console.timeEnd("render");if(this.p){switch(this.a()){case 1:this.p=!1;this.a(0.5);break;case 2:this.a(1);break;default:this.a(1)}this.d=!1;var b=this;setTimeout(function(){b.m()},0)}else this.d=!1;this.r&&this.r()};f.zoom=function(b){this.scale=b;this.i()};
f.v=function(b,a){this.offsetLeft+=(b/this.a()/this.width-0.5)*this.f*this.scale;this.offsetTop+=(a/this.a()/this.height-0.5)*this.g*this.scale;this.i()};f.reset=function(){this.offsetTop=this.offsetLeft=0;this.scale=1};f.a=function(b){if(!b)return this.u;this.u=b;this.t()};
f.random=function(){function b(a,b){for(var c=a.length,d=0,e=0;e<c;e++)var g=a[e]-b,d=d+g*g;return Math.pow(d/c,0.5)}function a(a){for(var b=0,c=a.length,d=0;d<c;d++)b+=a[d];return b/c}var c,e,d,g=0;do{c=[];this.scale=1/Math.pow(2,Math.floor(22*Math.random())+10);this.offsetLeft=this.f*(Math.random()-0.5);this.offsetTop=this.g*(Math.random()-0.5);for(g=0;16>g;g++)e=Math.floor(g%4*this.width/4),d=Math.floor(Math.floor(g/4)*this.height/4),c.push(this.q(e,d));g++}while(b(c,a(c))<this.G&&100>g);this.i()};
f.save=function(){var b=this.canvas.width,a=this.canvas.height,c="left=0,top=0,width="+b+",height="+a+",toolbar=0,resizable=0",e=this.canvas.toDataURL("image/png"),c=window.open("","Ingemi",c);c.document.write("<title>Ingemi Export Image</title>");c.document.write("<img id='exportImage' alt='' height='"+a+"' width='"+b+"' style='position:absolute;left:0;top:0'/>");c.document.close();c.document.getElementById("exportImage").src=e};window.Ingemi=Ingemi;Ingemi.prototype.init=Ingemi.prototype.C;
Ingemi.prototype.render=Ingemi.prototype.m;Ingemi.prototype.zoom=Ingemi.prototype.zoom;Ingemi.prototype.center=Ingemi.prototype.v;Ingemi.prototype.reset=Ingemi.prototype.reset;Ingemi.prototype.smartRender=Ingemi.prototype.i;Ingemi.prototype.random=Ingemi.prototype.random;Ingemi.prototype.save=Ingemi.prototype.save;Ingemi.prototype.upscale=Ingemi.prototype.a;
