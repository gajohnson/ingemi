var f=!1,h;
Ingemi=function(b,a){if(!b||"DIV"!=b.nodeName)throw Error("You must specify the div where Ingemi will render");a=a||{};this.o=b;this.z=a.upscale||1;this.offsetLeft=a.offsetLeft||0;this.offsetTop=a.offsetTop||0;this.g=3.5;this.h=2;this.scale=1;this.J=a.minStdDev||10;this.n=a.maxIteration||600;this.c=a.blockSize||2E3;this.t="function"===typeof a.onrender?a.onrender:null;this.D=Math.round(b.clientWidth*this.h/this.g)/b.clientHeight;this.k=this.e=f;this.L=6;this.f=new Uint16Array(this.c);this.w=0;console.log(this.f.length)};
h=Ingemi.prototype;h.G=function(){this.I();this.v()};
h.I=function(){this.canvas=document.createElement("canvas");this.o.appendChild(this.canvas);this.B=this.canvas.getContext("2d");this.clientWidth=this.o.clientWidth;this.clientHeight=this.o.clientHeight;this.canvas.style.width=this.clientWidth+"px";this.canvas.style.height=this.clientHeight+"px";this.j=document.createElement("canvas");this.M=this.j.getContext("2d");this.status=document.getElementById("status");this.O=document.getElementById("x");this.P=document.getElementById("y");this.Q=document.getElementById("z");
var b=this;setInterval(function(){b.status.innerText=Math.round(100*b.b/b.m)},1E3)};h.v=function(){this.width=Math.floor(this.clientWidth/this.a());this.height=Math.floor(this.clientHeight/this.a());this.j.width=this.width;this.j.height=this.height;this.d=this.M.createImageData(this.width,this.height);this.m=this.width*this.height};
h.p=function(){this.e||(this.e=!0,console.time("render"),this.status.innerText=0,this.O.innerText=this.offsetLeft,this.P.innerText=this.offsetTop,this.Q.innerText=Math.log(1/this.scale)/Math.LN2,this.b=this.i=this.q=0,this.u())};h.l=function(){this.e&&this.cancel();this.k=!0;this.a(this.L);console.log("cancel");this.p()};h.cancel=function(){this.k=f;for(var b=0;b<this.f.length;)clearTimeout(this.f[b]),b++;this.j.width=this.width;this.r()};
h.u=function(){function b(a,b){c.f[c.w++]=setTimeout(function(){c.N(4*c.F(a,b),c.s(a,b));c.R()})}var a=this.c+this.b>this.m?this.m-this.b:this.c;this.f=[];for(var c=this,d=0;d<a;){var e=this.b+d;b(e%this.width,Math.floor(e/this.width));d++}};h.F=function(b,a){return a*this.width+b};
h.s=function(b,a){var c,d;c=this.scale*(this.g*b/this.width-1.75)+this.offsetLeft;d=this.scale/this.D*(this.h*a/this.height-1)+this.offsetTop;if(this.H(c,d))return this.n;for(var e=0,g=0,i=0,j;4>e*e+g*g&&i<this.n;)j=e*e-g*g+c,g=2*e*g+d,e=j,i++;return i};h.H=function(b,a){var c=Math.pow(b-0.25,2)+a*a;return b<=Math.sqrt(c)-2*c+0.25};
h.N=function(b,a){var c,d,e,a=6*a/this.n;1>a?(c=255,d=255*a,e=0):2>a?(c=255*(2-a),d=255,e=0):3>a?(c=0,d=255,e=255*(a-2)):4>a?(c=0,d=255*(4-a),e=255):5>a?(c=255*(a-4),d=0,e=255):(c=255,d=0,e=255*(6-a));this.d.data[b]=c;this.d.data[b+1]=d;this.d.data[b+2]=e;this.d.data[b+3]=255};h.R=function(){this.q+=1;this.i+=1;this.q==this.m?(this.C(),this.r()):this.i===this.c&&(this.w=0,this.K())};h.K=function(){this.b+=this.c;this.i=0;this.u()};
h.C=function(){this.canvas.width=this.width;this.canvas.height=this.height;this.B.putImageData(this.d,0,0)};h.r=function(){this.status.innerText=100;console.timeEnd("render");if(this.k){switch(this.a()){case 1:this.k=f;this.a(0.5);break;case 2:this.a(1);break;default:this.a(2)}this.e=f;this.p()}else this.e=f;this.t&&this.t()};h.zoom=function(b){this.scale=b;this.l()};
h.A=function(b,a){this.offsetLeft+=(b/this.a()/this.width-0.5)*this.g*this.scale;this.offsetTop+=(a/this.a()/this.height-0.5)*this.h*this.scale;this.l()};h.reset=function(){this.offsetTop=this.offsetLeft=0;this.scale=1};h.a=function(b){if(!b)return this.z;this.z=b;this.v()};
h.random=function(){function b(a,b){for(var c=a.length,d=0,e=0;e<c;e++)var g=a[e]-b,d=d+g*g;return Math.pow(d/c,0.5)}function a(a){for(var b=0,c=a.length,d=0;d<c;d++)b+=a[d];return b/c}var c,d,e,g=0;do{c=[];this.scale=1/Math.pow(2,Math.floor(22*Math.random())+10);this.offsetLeft=this.g*(Math.random()-0.5);this.offsetTop=this.h*(Math.random()-0.5);for(g=0;16>g;g++)d=Math.floor(g%4*this.width/4),e=Math.floor(Math.floor(g/4)*this.height/4),c.push(this.s(d,e));g++}while(b(c,a(c))<this.J&&100>g);this.l()};
h.save=function(){var b=this.canvas.width,a=this.canvas.height,c="left=0,top=0,width="+b+",height="+a+",toolbar=0,resizable=0",d=this.canvas.toDataURL("image/png"),c=window.open("","Ingemi",c);c.document.write("<title>Ingemi Export Image</title>");c.document.write("<img id='exportImage' alt='' height='"+a+"' width='"+b+"' style='position:absolute;left:0;top:0'/>");c.document.close();c.document.getElementById("exportImage").src=d};window.Ingemi=Ingemi;Ingemi.prototype.init=Ingemi.prototype.G;
Ingemi.prototype.render=Ingemi.prototype.p;Ingemi.prototype.zoom=Ingemi.prototype.zoom;Ingemi.prototype.center=Ingemi.prototype.A;Ingemi.prototype.reset=Ingemi.prototype.reset;Ingemi.prototype.smartRender=Ingemi.prototype.l;Ingemi.prototype.random=Ingemi.prototype.random;Ingemi.prototype.save=Ingemi.prototype.save;Ingemi.prototype.upscale=Ingemi.prototype.a;
