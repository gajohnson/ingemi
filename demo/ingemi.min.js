var f=!1,h;Ingemi=function(b,d){if(!b||"DIV"!=b.nodeName)throw Error("You must specify the div where Ingemi will render");d=d||{};this.o=b;this.test=d.test||f;this.A=d.upscale||1;this.offsetLeft=d.offsetLeft||0;this.offsetTop=d.offsetTop||0;this.e=3.5;this.g=2;this.scale=1;this.O=d.minStdDev||10;this.n=d.maxIteration||2E3;this.f=d.blockSize||2E3;this.v="function"===typeof d.onrender?d.onrender:null;this.t=Math.round(b.clientWidth*this.g/this.e)/b.clientHeight;this.j=this.c=f;this.l=[];this.B=[]};
h=Ingemi.prototype;h.L=function(){this.N();this.z()};
h.N=function(){this.canvas=document.createElement("canvas");this.o.appendChild(this.canvas);this.I=this.canvas.getContext("2d");this.clientWidth=this.o.clientWidth;this.clientHeight=this.o.clientHeight;this.canvas.style.width=this.clientWidth+"px";this.canvas.style.height=this.clientHeight+"px";this.i=document.createElement("canvas");this.Q=this.i.getContext("2d");this.status=document.getElementById("status");this.S=document.getElementById("x");this.T=document.getElementById("y");this.U=document.getElementById("z")};
h.z=function(){this.width=Math.floor(this.clientWidth/this.a());this.height=Math.floor(this.clientHeight/this.a());this.i.width=this.width;this.i.height=this.height;this.d=this.Q.createImageData(this.width,this.height);this.m=this.width*this.height};h.p=function(){this.c||(this.c=!0,this.test&&console.time("render"),this.r(),this.status.innerText=0,this.S.innerText=this.offsetLeft,this.T.innerText=this.offsetTop,this.U.innerText=Math.log(1/this.scale)/Math.LN2,this.b=this.h=this.q=0,this.w())};
h.k=function(){this.c&&this.cancel();this.j=!0;this.a(1);this.p()};h.cancel=function(){for(this.j=f;this.l.length;)clearTimeout(this.l.pop());this.i.width=this.width;this.s();this.test=f};h.w=function(){function b(a,b){c.l.push(setTimeout(function(){c.R(4*c.K(a,b),c.u(a,b));c.V()},1))}var d=this.f+this.b>this.m?this.m-this.b:this.f;this.l=[];for(var c=this,e=0;e<d;e+=1){var a=this.b+e;b(a%this.width,Math.floor(a/this.width))}};h.K=function(b,d){return d*this.width+b};
h.u=function(b,d){var c,e;c=this.C*b+this.D;e=this.F*d+this.G;if(this.M(c,e))return this.n;for(var a=0,g=0,i=0,j;4>a*a+g*g&&i<this.n;)j=a*a-g*g+c,g=2*a*g+e,a=j,i++;return i};h.r=function(){this.C=this.scale*this.e/this.width;this.D=this.offsetLeft-this.scale*this.e/2;this.F=this.scale*this.g/(this.t*this.height);this.G=this.offsetTop-this.scale/this.t};h.M=function(b,d){var c=Math.pow(b-0.25,2)+d*d;return b<=Math.sqrt(c)-2*c+0.25};
h.R=function(b,d){var c,e,a;(a=this.B[d])||(a=this.B[d]=6-6*d/this.n);1>a?(c=255,e=255*a,a=0):2>a?(c=255*(2-a),e=255,a=0):3>a?(c=0,e=255,a=255*(a-2)):4>a?(c=0,e=255*(4-a),a=255):5>a?(c=255*(a-4),e=0,a=255):(c=255,e=0,a=255*(6-a));this.d.data[b]=c;this.d.data[b+1]=e;this.d.data[b+2]=a;this.d.data[b+3]=255};h.V=function(){this.q+=1;this.h+=1;this.q==this.m?(this.J(),this.s()):this.h===this.f&&this.P()};h.P=function(){this.b+=this.f;this.status.innerText=Math.round(100*this.b/this.m);this.h=0;this.w()};
h.J=function(){this.canvas.width=this.width;this.canvas.height=this.height;this.I.putImageData(this.d,0,0)};h.s=function(){this.status.innerText=100;this.test&&console.timeEnd("render");if(this.j){if(this.test){this.c=f;this.random();return}switch(this.a()){case 1:this.a(0.5);break;case 2:this.a(1);break;default:this.j=f,this.a(2)}this.c=f;this.p()}else this.c=f,this.test&&this.random();this.v&&this.v()};h.zoom=function(b){this.scale=b;this.k()};
h.H=function(b,d){this.offsetLeft+=(b/this.a()/this.width-0.5)*this.e*this.scale;this.offsetTop+=(d/this.a()/this.height-0.5)*this.g*this.scale;this.k()};h.reset=function(){this.offsetTop=this.offsetLeft=0;this.scale=1};h.a=function(b){if(!b)return this.A;this.A=b;this.z()};
h.random=function(){function b(a,b){for(var c=a.length,d=0,e=0;e<c;e++)var g=a[e]-b,d=d+g*g;return Math.pow(d/c,0.5)}function d(a){for(var b=0,d=a.length,c=0;c<d;c++)b+=a[c];return b/d}var c,e,a;do{c=[];this.scale=1/Math.pow(2,Math.floor(22*Math.random())+10);this.offsetLeft=this.e*(Math.random()-0.5);this.offsetTop=this.g*(Math.random()-0.5);this.r();for(var g=0;16>g;g++)e=Math.floor(g%4*this.width/4),a=Math.floor(Math.floor(g/4)*this.height/4),c.push(this.u(e,a))}while(b(c,d(c))<this.O);this.k()};
h.save=function(){var b=this.canvas.width,d=this.canvas.height,c="left=0,top=0,width="+b+",height="+d+",toolbar=0,resizable=0",e=this.canvas.toDataURL("image/png"),c=window.open("","Ingemi",c);c.document.write("<title>Ingemi Export Image</title>");c.document.write("<img id='exportImage' alt='' height='"+d+"' width='"+b+"' style='position:absolute;left:0;top:0'/>");c.document.close();c.document.getElementById("exportImage").src=e};window.Ingemi=Ingemi;Ingemi.prototype.init=Ingemi.prototype.L;
Ingemi.prototype.render=Ingemi.prototype.p;Ingemi.prototype.zoom=Ingemi.prototype.zoom;Ingemi.prototype.center=Ingemi.prototype.H;Ingemi.prototype.reset=Ingemi.prototype.reset;Ingemi.prototype.smartRender=Ingemi.prototype.k;Ingemi.prototype.random=Ingemi.prototype.random;Ingemi.prototype.save=Ingemi.prototype.save;Ingemi.prototype.upscale=Ingemi.prototype.a;
