var d;Ingemi=function(a,b){if(!a||"DIV"!=a.nodeName)throw Error("You must specify Ingemi's container");b=b||{};this.f=a;this.x=b.x||0;this.y=b.y||0;this.a=b.z||1;this.J=b.iterations||255;this.i=b.sample||1;this.k=b.workers||4;this.L=b.minStdDev||10;this.v="function"===typeof b.onrender?b.onrender:null;this.o=3.5;this.p=2;this.e=[];this.l=[];this.r={};this.d=!1};d=Ingemi.prototype;d.I=function(){this.K();this.B();this.Q()};
d.K=function(){this.b=document.createElement("canvas");this.f.appendChild(this.b);this.s=this.b.getContext("2d")};d.B=function(){var a=this.f.clientWidth,b=this.f.clientHeight;this.j=Math.floor(a/this.i);this.g=Math.floor(b/this.i);this.b.style.width=a+"px";this.b.style.height=b+"px";this.t=Math.round(a*this.p/this.o)/b;this.M=this.j*this.g;this.u=this.s.createImageData(this.j,this.g);this.c=[];for(a=0;a<this.k;a++)this.c[a]=new ArrayBuffer(this.q(a+1)-this.q(a))};
d.Q=function(){for(var a=this,b=0;b<this.k;b++){this.e[b]=new Worker("js/w.mandelbrot.js");var c=this.m("init");this.e[b].postMessage(c);this.e[b].onmessage=function(b){a.G(b.data)}}};d.D=function(a){for(var b=0,c=this.l.length;b<c;b++)if(!this.l[b])return;this.F();if(a&&(b=this.r[a]))b(),delete this.r[a]};d.n=function(a,b){if(!this.d){this.d=!0;this.A=a||!1;for(var c=0;c<this.k;c++){this.l[c]=!1;var e=this.m("draw",c,b);this.e[c].postMessage(e,[this.c[c]])}}};
d.m=function(a,b,c){var e={};e.type=a;if(c){var f=Math.floor(1E5*Math.random());this.r[f]=c;e.callback=f}switch(a){case "init":b=e.settings={};b.dx=this.o;b.dy=this.p;b.hScale=this.t;b.w=this.j;b.h=this.g;b.iterations=this.J;b.minStdDev=this.L;break;case "draw":a=e.state={},a.x=this.x,a.y=this.y,a.z=this.a,a.offset=this.q(b),a.size=this.c[b].byteLength,a.block=b,e.buf=this.c[b]}return e};d.q=function(a){return 4*Math.ceil(this.M*a/this.k)};
d.G=function(a){switch(a.type){case "draw":var b=a.callback||null,c=a.block;this.c[c]=a.image;this.u.data.set(new Uint8ClampedArray(this.c[c]),a.offset);this.l[c]=!0;this.D(b);break;case "rand":this.x=a.x||this.x,this.y=a.y||this.y,this.a=a.z||this.a,this.n()}};d.F=function(){this.b.width=this.j;this.b.height=this.g;this.s.putImageData(this.u,0,0);this.d=!1;this.v&&!this.A&&(this.A=!1,this.v())};d.T=function(a){this.d||(this.a*=a,this.n())};
d.C=function(a,b){this.d||(this.x+=(a/this.i/this.j-0.5)*this.o*this.a,this.y+=(b/this.i/this.g-0.5)*this.p*this.a/this.t,this.n())};d.O=function(a){this.i=a;this.B();for(a=0;a<this.k;a++){var b=this.m("init");this.e[a].postMessage(b)}};d.S=function(){return this.f.clientWidth};d.H=function(){return this.f.clientHeight};d.R=function(a){if(!a)return{x:this.x,y:this.y,z:this.a};this.x=a.x||this.x;this.y=a.y||this.y;this.a=a.z||this.a};d.N=function(){this.d||this.e[0].postMessage(this.m("rand"))};
d.P=function(a){var b,c=this.b.width,e=this.b.height,f=this.b.toDataURL("image/png");a||(a=window.open("","Ingemi","left=0,top=0,toolbar=0,resizable=0,width="+c+",height="+e),a.document.write("<title>Ingemi Export Image</title>"),a.document.write("<img id='exportImage' style='position:absolute;left:0;top:0' height='"+e+"' width='"+c+"'/>"),a.document.close(),b=a.document.getElementById("exportImage"));b.src=f};window.Ingemi=Ingemi;Ingemi.prototype.init=Ingemi.prototype.I;Ingemi.prototype.render=Ingemi.prototype.n;
Ingemi.prototype.zoom=Ingemi.prototype.T;Ingemi.prototype.center=Ingemi.prototype.C;Ingemi.prototype.resample=Ingemi.prototype.O;Ingemi.prototype.width=Ingemi.prototype.S;Ingemi.prototype.height=Ingemi.prototype.H;Ingemi.prototype.state=Ingemi.prototype.R;Ingemi.prototype.rand=Ingemi.prototype.N;Ingemi.prototype.save=Ingemi.prototype.P;
