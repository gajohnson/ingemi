var c;Ingemi=function(a,b){if(!a||"DIV"!=a.nodeName)throw Error("You must specify Ingemi's container");b=b||{};this.a=a;this.x=b.x||0;this.y=b.y||0;this.c=b.z||1;this.Q=b.iterations||255;this.f=b.sample||1;this.m=b.workers||4;this.S=b.minStdDev||10;this.p=3.5;this.q=2;this.j=[];this.n=[];this.t={};this.e=!1};c=Ingemi.prototype;c.P=function(){this.e||(this.R(),this.F(),this.V(),this.G())};c.R=function(){this.d=document.createElement("canvas");this.a.appendChild(this.d);this.A=this.d.getContext("2d")};
c.F=function(){var a=this.a.clientWidth,b=this.a.clientHeight;this.l=Math.floor(a/this.f);this.k=Math.floor(b/this.f);this.d.style.width=a+"px";this.d.style.height=b+"px";this.B=Math.round(a*this.q/this.p)/b;this.T=this.l*this.k;this.C=this.A.createImageData(this.l,this.k);this.g=[];for(a=0;a<this.m;a++)this.g[a]=new ArrayBuffer(this.r(a+1)-this.r(a))};
c.V=function(){for(var a=this,b=0;b<this.m;b++){this.j[b]=new Worker("js/w.mandelbrot.js");var d=this.o("init");this.j[b].postMessage(d);this.j[b].onmessage=function(b){a.M(b.data)}}};c.H=function(a){for(var b=0,d=this.n.length;b<d;b++)if(!this.n[b])return;this.J();if(a&&(b=this.t[a]))b(),delete this.t[a]};c.b=function(a){if(!this.e){this.e=!0;for(var a="function"===typeof a?a:null,b=0;b<this.m;b++){this.n[b]=!1;var d=this.o("draw",b,a);this.j[b].postMessage(d,[this.g[b]])}}};
c.o=function(a,b,d){var e={};e.type=a;if(d){var f=Math.floor(1E5*Math.random());this.t[f]=d;e.callback=f}switch(a){case "init":b=e.settings={};b.dx=this.p;b.dy=this.q;b.hScale=this.B;b.w=this.l;b.h=this.k;b.iterations=this.Q;b.minStdDev=this.S;break;case "draw":a=e.state={},a.x=this.x,a.y=this.y,a.z=this.c,a.offset=this.r(b),a.size=this.g[b].byteLength,a.block=b,e.buf=this.g[b]}return e};c.r=function(a){return 4*Math.ceil(this.T*a/this.m)};
c.M=function(a){switch(a.type){case "draw":var b=a.callback||null,d=a.block;this.g[d]=a.image;this.C.data.set(new Uint8ClampedArray(this.g[d]),a.offset);this.n[d]=!0;this.H(b);break;case "rand":this.x=a.x||this.x,this.y=a.y||this.y,this.c=a.z||this.c,this.b()}};c.J=function(){this.d.width=this.l;this.d.height=this.k;this.A.putImageData(this.C,0,0);this.e=!1};c.v=function(a){this.e||(this.c*=a)};
c.i=function(a,b){this.e||(this.x+=(a/this.f/this.l-0.5)*this.p*this.c,this.y+=(b/this.f/this.k-0.5)*this.q*this.c/this.B)};c.u=function(a){if(!a)return this.f;if(!this.e){this.f=a;this.F();for(a=0;a<this.m;a++){var b=this.o("init");this.j[a].postMessage(b)}}};c.X=function(){return this.a.clientWidth};c.O=function(){return this.a.clientHeight};c.W=function(a){if(!a)return{x:this.x,y:this.y,z:this.c};this.x=a.x||this.x;this.y=a.y||this.y;this.c=a.z||this.c};c.D=function(){this.e||this.j[0].postMessage(this.o("rand"))};
c.G=function(){this.s(window,"keydown",this.L);this.s(window,"resize",this.I(this.N));this.s(this.a,"click",this.K)};c.s=function(a,b,d){var e=this;a.addEventListener(b,function(a){d.call(e,a)})};c.N=function(){this.b()};c.K=function(a){this.i(a.clientX,a.clientY);this.b()};
c.L=function(a){switch(a.keyCode){case 82:this.D();break;case 87:this.v(1/1.05);this.b();break;case 83:this.v(2);this.b();break;case 65:this.u(2*this.f);this.b();break;case 68:this.u(this.f/2);this.b();break;case 37:this.i(0,this.a.clientHeight/2);this.b();break;case 39:this.i(this.a.clientWidth,this.a.clientHeight/2);this.b();break;case 38:this.i(this.a.clientWidth/2,0);this.b();break;case 40:this.i(this.a.clientWidth/2,this.a.clientHeight);this.b();break;case 90:this.save()}};
c.U=function(a){var b,d=this.d.width,e=this.d.height,f=this.d.toDataURL("image/png");a||(a=window.open("","Ingemi","left=0,top=0,toolbar=0,resizable=0,width="+d+",height="+e),a.document.write("<title>Ingemi Export Image</title>"),a.document.write("<img id='exportImage' style='position:absolute;left:0;top:0' height='"+e+"' width='"+d+"'/>"),a.document.close(),b=a.document.getElementById("exportImage"));b.src=f};
c.I=function(a){var b;return function(){var d=this,e=arguments;b&&clearTimeout(b);b=setTimeout(function(){a.apply(d,e);b=null},500)}};window.Ingemi=Ingemi;Ingemi.prototype.init=Ingemi.prototype.P;Ingemi.prototype.render=Ingemi.prototype.b;Ingemi.prototype.zoom=Ingemi.prototype.v;Ingemi.prototype.center=Ingemi.prototype.i;Ingemi.prototype.resample=Ingemi.prototype.u;Ingemi.prototype.width=Ingemi.prototype.X;Ingemi.prototype.height=Ingemi.prototype.O;Ingemi.prototype.state=Ingemi.prototype.W;
Ingemi.prototype.rand=Ingemi.prototype.D;Ingemi.prototype.save=Ingemi.prototype.U;
