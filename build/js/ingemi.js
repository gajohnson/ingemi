var c;Ingemi=function(a,b){if(!a||"DIV"!=a.nodeName)throw Error("You must specify Ingemi's container");b=b||{};this.d=a;this.x=b.x||0;this.y=b.y||0;this.a=b.z||1;this.D=this.maxIteration=b.maxIteration||255;this.j=b.sample||1;this.k=b.workers||4;this.F=b.minStdDev||10;this.l=3.5;this.m=2;this.f=[];this.h=[];this.c=!1};c=Ingemi.prototype;c.B=function(){this.C();this.I();this.J()};c.C=function(){this.b=document.createElement("canvas");this.d.appendChild(this.b);this.p=this.b.getContext("2d")};
c.I=function(){var a=this.d.clientWidth,b=this.d.clientHeight;this.g=Math.floor(a/this.j);this.e=Math.floor(b/this.j);this.b.style.width=a+"px";this.b.style.height=b+"px";this.q=Math.round(a*this.m/this.l)/b;this.s=this.g*this.e;this.r=this.p.createImageData(this.g,this.e);this.buffer=[];for(a=0;a<this.k;a++)this.buffer[a]=new ArrayBuffer(this.n(a+1)-this.n(a))};
c.J=function(){for(var a=this,b=0;b<this.k;b++){this.f[b]=new Worker("js/w.mandelbrot.js");var e=this.o("init");this.f[b].postMessage(e);this.f[b].onmessage=function(b){a.w(b.data)}}};c.u=function(){for(var a=0,b=this.h.length;a<b;a++)if(!this.h[a])return;this.v()};c.i=function(){if(!this.c){this.c=!0;for(var a=0;a<this.k;a++){this.h[a]=!1;var b=this.o("draw",a);this.f[a].postMessage(b,[this.buffer[a]])}}};
c.o=function(a,b){var e={};e.type=a;switch(a){case "init":var d=e.settings={};d.dx=this.l;d.dy=this.m;d.forcedHeight=this.q;d.totalPixels=this.s;d.width=this.g;d.height=this.e;d.maxIteration=this.D;d.minStdDev=this.F;break;case "draw":d=e.state={},d.x=this.x,d.y=this.y,d.z=this.a,d.blockOffset=this.n(b),d.blockSize=this.buffer[b].byteLength,d.index=b,e.buffer=this.buffer[b]}return e};c.n=function(a){return 4*Math.ceil(this.s*a/this.k)};
c.w=function(a){switch(a.type){case "draw":var b=a.index;this.buffer[b]=a.imagedata;this.r.data.set(new Uint8ClampedArray(this.buffer[b]),a.blockOffset);this.h[b]=!0;this.u();break;case "rand":this.x=a.x||this.x,this.y=a.y||this.y,this.a=a.z||this.a,this.i()}};c.v=function(){this.b.width=this.g;this.b.height=this.e;this.p.putImageData(this.r,0,0);this.c=!1};c.M=function(a){this.c||(this.a*=a,this.i())};
c.t=function(a,b){this.c||(this.x+=(a/this.j/this.g-0.5)*this.l*this.a,this.y+=(b/this.j/this.e-0.5)*this.m*this.a/this.q,this.i())};c.L=function(){return this.d.clientWidth};c.A=function(){return this.d.clientHeight};c.K=function(a){if(!a)return{x:this.x,y:this.y,z:this.a};this.x=a.x||this.x;this.y=a.y||this.y;this.a=a.z||this.a};c.G=function(){this.c||this.f[0].postMessage(this.o("rand"))};
c.H=function(a){var b,e=this.b.width,d=this.b.height,f=this.b.toDataURL("image/png");a||(a=window.open("","Ingemi","left=0,top=0,toolbar=0,resizable=0,width="+e+",height="+d),a.document.write("<title>Ingemi Export Image</title>"),a.document.write("<img id='exportImage' style='position:absolute;left:0;top:0' height='"+d+"' width='"+e+"'/>"),a.document.close(),b=a.document.getElementById("exportImage"));b.src=f};window.Ingemi=Ingemi;Ingemi.prototype.init=Ingemi.prototype.B;Ingemi.prototype.render=Ingemi.prototype.i;
Ingemi.prototype.zoom=Ingemi.prototype.M;Ingemi.prototype.center=Ingemi.prototype.t;Ingemi.prototype.width=Ingemi.prototype.L;Ingemi.prototype.height=Ingemi.prototype.A;Ingemi.prototype.state=Ingemi.prototype.K;Ingemi.prototype.rand=Ingemi.prototype.G;Ingemi.prototype.save=Ingemi.prototype.H;
