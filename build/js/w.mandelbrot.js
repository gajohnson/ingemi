var j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y;function z(a,b){var c=n*(q*a/u-1.75)+l,f=n/s*(r*b/v-1)+m,e=(c-0.25)*(c-0.25)+f*f;if(c<=Math.sqrt(e)-2*e+0.25)return w;var d=e=0,g;for(g=0;4>e*e+d*d&&g<w;g++)var h=e*e-d*d+c,d=2*e*d+f,e=h;return g}function A(a){for(var b=0,c=a.length,f=0;f<c;f++)b+=a[f];return b/c}function B(a,b){for(var c=a.length,f=0,e=0;e<c;e++)var d=a[e]-b,f=f+d*d;return Math.pow(f/c,0.5)}handleInitRequest=function(a){q=a.dx;r=a.dy;s=a.forcedHeight;u=a.width;v=a.height;w=a.maxIteration;y=a.minStdDev};
handleRenderRequest=function(a,b){var c=b.state;l=c.x;m=c.y;n=c.z;o=c.blockOffset;t=c.blockSize;p=c.index;k=b.buffer;x=new Uint32Array(k);for(var c=o/4,f=c+t/4,e=c;c<f;c++){var d=z(c%u,Math.floor(c/u)),g=void 0,h=void 0,i=void 0,d=6*d/w;1>d?(g=255,h=255*d,i=0):2>d?(g=255*(2-d),h=255,i=0):3>d?(g=0,h=255,i=255*(d-2)):4>d?(g=0,h=255*(4-d),i=255):5>d?(g=255*(d-4),h=0,i=255):(g=255,h=0,i=255*(6-d));x[c-e]=-16777216|i<<16|h<<8|g}a.imagedata=k;a.blockOffset=o;a.index=p};
handleRandomRequest=function(){var a,b=0;do{a=[];n=1/Math.pow(2,Math.floor(22*Math.random())+10);l=q*(Math.random()-0.5);m=r*(Math.random()-0.5);for(b=0;64>b;b++)a.push(z(Math.floor(b%8*u/8),Math.floor(Math.floor(b/8)*v/8)));b++}while(B(a,A(a))<y&&100>b)};
self.onmessage=function(a){var b={},a=a.data;j=b.type=a.type;switch(j){case "init":handleInitRequest(a.settings);break;case "render":handleRenderRequest(b,a);break;case "random":handleRandomRequest()}b.x=l;b.y=m;b.z=n;k&&k.byteLength?self.postMessage(b,[k]):self.postMessage(b)};
