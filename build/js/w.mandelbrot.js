var i,j,k,m,n,o,p,q,r,s,t,u,v,w,x,y;function z(a,b){var c=n*(q*a/u-1.75)+k,f=n/s*(r*b/v-1)+m,e=(c-0.25)*(c-0.25)+f*f;if(c<=Math.sqrt(e)-2*e+0.25)return w;var d=e=0,g;for(g=0;4>e*e+d*d&&g<w;g++)var h=e*e-d*d+c,d=2*e*d+f,e=h;return g}function A(a){for(var b=0,c=a.length,f=0;f<c;f++)b+=a[f];return b/c}function B(a,b){for(var c=a.length,f=0,e=0;e<c;e++)var d=a[e]-b,f=f+d*d;return Math.pow(f/c,0.5)}init=function(a){q=a.dx;r=a.dy;s=a.hScale;u=a.w;v=a.h;w=a.iterations;y=a.minStdDev};
draw=function(a,b){var c=b.state;k=c.x;m=c.y;n=c.z;o=c.offset;t=c.size;p=c.block;j=b.buf;x=new Uint32Array(j);for(var c=o/4,f=c+t/4,e=c;c<f;c++){var d=6*z(c%u,Math.floor(c/u))/w,g=void 0,h=void 0,l=void 0;1>d?(g=220*d,h=15,l=220*d):2>d?(g=220*(2-d),h=15,l=220):3>d?(g=15,h=220*(d-2),l=220*(3-d)):(4>d?(g=220*(d-3),h=220):5>d?(g=220,h=220*(5-d)):(g=220*(6-d),h=15),l=15);x[c-e]=-16777216|l<<16|h<<8|g}a.image=j;a.offset=o;a.block=p};
rand=function(){var a,b=0;do{a=[];n=1/Math.pow(2,Math.floor(22*Math.random())+10);k=q*(Math.random()-0.5);m=r*(Math.random()-0.5);for(b=0;64>b;b++)a.push(z(Math.floor(b%8*u/8),Math.floor(Math.floor(b/8)*v/8)));b++}while(B(a,A(a))<y&&100>b)};self.onmessage=function(a){var b={},a=a.data;i=b.type=a.type;switch(i){case "init":init(a.settings);break;case "draw":draw(b,a);break;case "rand":rand()}b.x=k;b.y=m;b.z=n;j&&j.byteLength?self.postMessage(b,[j]):self.postMessage(b)};
